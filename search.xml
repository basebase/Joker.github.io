<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[javaè¿”å›å¼•ç”¨å’Œè¿”å›å¯¹è±¡]]></title>
      <url>http://yoursite.com/2016/09/06/java%E8%BF%94%E5%9B%9E%E5%BC%95%E7%94%A8%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/</url>
      <content type="html"><![CDATA[<h3 id="ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« "><a href="#ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« " class="headerlink" title="ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ?"></a>ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ?</h3><p>åœ¨å†™java finalizeæ–‡ç« çš„æ—¶æˆ‘è¯´è¿‡ï¼Œæœ‰ä¸€ä¸ªåŒäº‹é—®äº†ä¸€ä¸ªé—®é¢˜ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« å°±æ˜¯è®°å½•æ­¤é—®é¢˜ã€‚<br>é‚£ä¹ˆç©¶ç«Ÿæ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>
<h3 id="é—®é¢˜çš„äº§ç”Ÿ"><a href="#é—®é¢˜çš„äº§ç”Ÿ" class="headerlink" title="é—®é¢˜çš„äº§ç”Ÿ"></a>é—®é¢˜çš„äº§ç”Ÿ</h3><p>äº‹æƒ…å‘ç”Ÿåœ¨ä¸­åˆï¼Œå½“æ—¶æˆ‘æ­£åœ¨å†™codeï¼Œç„¶åè®¨è®ºç»„é‡Œé¢å‘å‡ºä¸€ä¸ªé—®é¢˜è¯´</p>
<font color="DeepPink"><br>    javaæ–¹æ³•ä¸­ç›´æ¥newå¯¹è±¡è¿”å›å’Œèµ‹å€¼è¿”å›æœ‰ä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿ<br></font>

<p>ç„¶è€Œï¼Œå°±æœ‰ä¸€ä½åŒäº‹è¯´å‡ºäº†gcï¼Œç„¶åå°±æ²¡ç„¶åäº†ï¼<br>åŒ…æ‹¬æˆ‘å½“æ—¶ä¹Ÿåªæ˜¯è¯´åˆ°å¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨å°±è¢«å›æ”¶ï¼ˆå…¶å®è¿™é‡Œè¯´çš„ä¹Ÿè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œåªèƒ½è¯´ä¼šè¢«åŠ å…¥åˆ°F-Queueä¸­ï¼Œç„¶åç­‰å¾…å¤„ç†ï¼‰ã€‚</p>
<p>å› ä¸ºGCåˆ°åº•ä»€ä¹ˆæ—¶å€™æ‰§è¡Œæˆ‘ä¹ˆæ˜¯ä¸æ¸…æ¥šçš„ï¼Œä¸åŒçš„jvmæœ‰ä¸åŒçš„ç®—æ³•ã€‚</p>
<p>æˆ‘æœ¬ç€ä¸€é¢—æœç´¢çš„å¿ƒï¼Œå‘ç°æœ‰äººè¯´javaçš„newè¿”å›çš„æ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œç„¶åæˆ‘å°±å„ç§æœç´¢ä¸´æ—¶å¯¹è±¡çš„èµ„æ–™<br>æ— æœï¼Œå…¨éƒ¨éƒ½æ˜¯C/C++çš„æè¿°ï¼Œç”±äºæˆ‘æ²¡æœ‰æ¥è§¦C/C++æ‰€ä»¥çœ‹çš„ä¹Ÿæœ‰ç‚¹äº‘é‡Œé›¾é‡Œ!</p>
<p>åæ¥ç»è¿‡å¤§ç‰›çš„æŒ‡ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p>
<font color="DeepPink"><br>    å…¶å®javaæ²¡æœ‰ä¸´æ—¶çš„æ¦‚å¿µï¼Œä¸åƒcæœ‰æ ˆç©ºé—´ä¸Šçš„å¯¹è±¡ã€‚Javaå¯¹è±¡éƒ½æ˜¯å †ä¸Šçš„ï¼Œé€šè¿‡å¼•ç”¨æ“ä½œå¯¹è±¡<br></font><br>çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯ä¸€ç›®äº†ç„¶äº†ğŸ˜<br><br>å½“çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå°±ä¼šéšä¹‹åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§ï¼Œå¹¶å°†å»ºç«‹çš„æ ˆå¸§å‹æ ˆã€‚å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¾¿ä¼šå°†æ ˆå¸§å‡ºæ ˆã€‚æˆ‘ä»¬çŸ¥é“å±€éƒ¨å˜é‡éƒ½æ˜¯æ”¾åœ¨æ ˆä¸­çš„ã€‚<br><br>æ¥ï¼Œçœ‹çœ‹ä¸‹å›¾<br><br><img src="https://github.com/basebase/img_server/blob/master/java%E8%BF%94%E5%9B%9E%E5%BC%95%E7%94%A8%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/11111.png?raw=true" alt="jvm stack"><br><br>é‚£ä¹ˆå½“æ–¹æ³•è¿”å›ç»“æŸäº†ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯æ²¡æœ‰è¢«å¼•ç”¨äº†ï¼Œä¹Ÿå°±åŠ å…¥åˆ°F-Queueä¸­ç­‰å¾…å¤„ç†äº†ã€‚<br>è€Œåœ¨returnç›´æ¥newè¿”å›ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚<br><br>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä¹ˆåŸºæœ¬ä¸Šå¯ä»¥è®¤ä¸ºäºŒè€…æ²¡æœ‰åŒºåˆ«ï¼Œå¦‚æœæœ‰ä¹Ÿæ˜¯å¾®ä¹å…¶å¾®çš„äº†ã€‚<br><br>### å®è·µ<br><br><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">getDate</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Date();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">		System.out.println(<span class="string">"1"</span>);</div><div class="line">		Date date = getDate();</div><div class="line">		<span class="comment">//System.gc();</span></div><div class="line">		Thread.sleep(<span class="number">10000</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><br><br>ä¸‹å›¾æ˜¯æ²¡æœ‰è¿›è¡Œgcæ—¶å€™è¿è¡Œæƒ…å†µã€‚<br><img src="https://github.com/basebase/img_server/blob/master/java%E8%BF%94%E5%9B%9E%E5%BC%95%E7%94%A8%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/usedmem.png?raw=true" alt="jvm stack"><br><br>ä¸Šå›¾ç¨‹åºæˆ‘è¿è¡Œäº†å¥½å‡ æ¬¡ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ä½¿ç”¨æƒ…å†µéƒ½å¦‚ä¸Šï¼Œä½ ä¹ˆåœ¨è¿è¡Œçš„æ—¶å€™å¯ä»¥å¤šæµ‹è¯•çœ‹çœ‹ã€‚<br><br>ç„¶åæŠŠSystem.gc()çš„æ³¨é‡Šè§£å¼€ï¼Œåœ¨æ¥è§‚å¯Ÿä¸€ä¸‹ã€‚<br><br>è¿è¡Œæƒ…å†µè‰¯å¥½çš„ä¸€æ¬¡ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://github.com/basebase/img_server/blob/master/java%E8%BF%94%E5%9B%9E%E5%BC%95%E7%94%A8%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/gc1.png?raw=true" alt="jvm gc"><br><br>å¯ä»¥çœ‹åˆ°å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œgcç¡®å®æ‰§è¡Œäº†ã€‚<br><br>ç„¶è€Œï¼Œæˆ‘ä»¬åœ¨çœ‹çœ‹è¿è¡ŒNæ¬¡åçš„æƒ…å†µï¼Œä¸ºäº†ä¸‹å›¾æˆ‘ä¹Ÿæ˜¯æ¶ˆè€—äº†ä¸€äº›æ—¶é—´ï¼ï¼ï¼<br><img src="https://github.com/basebase/img_server/blob/master/java%E8%BF%94%E5%9B%9E%E5%BC%95%E7%94%A8%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/gc2.png?raw=true" alt="jvm gc2"><br><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæ˜¯ä¸æ˜¯è¿˜å¾ˆé«˜ï¼Œè¿™å°±è¯´æ˜äº†<br><font color="DeepPink"><br>    è°ƒç”¨javaçš„System.gc()ä¸ä¸€å®šä¼šæ‰§è¡ŒGCæ“ä½œ<br></font>

<p>å¥½äº†ï¼Œåˆ°è¿™é‡Œå°±å·²ç»ç»“æŸäº†ï¼Œè¿™é‡Œæˆ‘å†™çš„æ˜¯return newçš„è¿”å›ï¼Œè¿”å›å¼•ç”¨æ²¡æœ‰å·®åˆ«ï¼Œå½“ç„¶ä½ ä¹ˆè‡ªå·±<br>ä¹Ÿå¯ä»¥æµ‹è¯•ä¸€ä¸‹ğŸ˜</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å…¶å®ä¹Ÿä¸ç®—æ˜¯æ€»ç»“å§ï¼Œä¹Ÿæ˜¯ä»Šå¤©çœ‹åˆ°çš„ï¼Œåœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™å°½é‡ä½¿ç”¨å±€éƒ¨å˜é‡ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„<br>æ§åˆ¶å†…å­˜ï¼Œåœ¨æ–¹æ³•ç»“æŸçš„æ—¶å€™ï¼Œæ ˆä¸­çš„æ•°æ®ä¼šè‡ªåŠ¨é‡Šæ”¾è€Œä¸ç”¨æˆ‘ä»¬æ“å¿ƒäº†ï¼ï¼ï¼</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[java finalizeæ–¹æ³•]]></title>
      <url>http://yoursite.com/2016/08/27/java-finalize%E6%96%B9%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ?<br>è¦è¯´finalizeæ–¹æ³•æˆ‘æƒ³åšjavaçš„éƒ½çŸ¥é“ï¼Œé‚£ä¹ˆfinalizeæ–¹æ³•ä¼šä¸ä¼šæ‰§è¡Œï¼Œå¦‚æœä¼šä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿå¦‚æœé‡å†™finalizeæ–¹æ³•åˆæœ‰ä»€ä¹ˆä¸¥é‡çš„åæœ? </p>
<a id="more"></a>
<h3 id="ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« "><a href="#ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« " class="headerlink" title="ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ?"></a>ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ?</h3><p>è¦è¯´finalizeæ–¹æ³•æˆ‘æƒ³åšjavaçš„éƒ½çŸ¥é“ï¼Œé‚£ä¹ˆfinalizeæ–¹æ³•ä¼šä¸ä¼šæ‰§è¡Œï¼Œå¦‚æœä¼šä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿå¦‚æœé‡å†™finalizeæ–¹æ³•åˆæœ‰ä»€ä¹ˆä¸¥é‡çš„åæœ? </p>
<p>é¢˜å¤–è¯ï¼šä»¥å‰çœ‹Java GCç›¸å…³å†…å®¹ä¸»è¦ä¸ºçš„æ˜¯åº”ä»˜é¢è¯•è€Œå·²ï¼Œä¸è¿‡æœ€è¿‘æœ‰ä¸ªåŒäº‹æäº†ä¸ªé—®é¢˜(é—®é¢˜ä½ ä¹ˆå…ˆYY)ï¼Œä½†ä»–åªè¯´äº†å¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œå…·ä½“ç»†èŠ‚å¹¶æ²¡æœ‰è¯´å‡ºï¼Œè¿›è€Œå¼•å‘æˆ‘å†æ¬¡æ¢ç©¶GC<br>ä¼°è®¡ä¸‹æ¬¡ä¼šä»¥æ­¤é—®é¢˜å±•å¼€è®¨è®ºï¼Œç”±äºæˆ‘ä¹Ÿæ˜¯ä¸ªèœé¸Ÿéœ€è¦å¤§å®¶æŒ‡å‡ºæ–‡ç« ä¸­çš„ä¸è¶³ï¼Œè°¢è°¢ï¼</p>
<h3 id="Java-finalizeæ–¹æ³•"><a href="#Java-finalizeæ–¹æ³•" class="headerlink" title="Java finalizeæ–¹æ³•"></a>Java finalizeæ–¹æ³•</h3><p>finalizeæ–¹æ³•æ˜¯Objectç±»çš„æ–¹æ³•ï¼Œä»»ä½•ç±»éƒ½æ˜¯é‡å†™finalizeæ–¹æ³•ï¼Œå®ç°è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ã€‚<br>é»˜è®¤çš„finalizeæ–¹æ³•ä»€ä¹ˆä¹Ÿæ²¡åš</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123; &#125;</div></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä¸€èˆ¬éƒ½ä¸å»ºè®®è‡ªå·±é‡å†™finalizeæ–¹æ³•ï¼Œç”±äºåœ¨æ¸…ç†å¯¹è±¡æ—¶å€™æ— æ³•ä¿è¯finalizeæ–¹æ³•ä¸€å®šä¼šè¢«æ‰§è¡Œã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€æ®µå°ç¨‹åºéå¸¸çš„ç®€å•ï¼Œå°±æ˜¯æ‰“å°ä¸€å¥è¯ï¼Œç„¶åç¨‹åºå°±ç»“æŸäº†ã€‚<br>é‚£ä¹ˆï¼Œå¯¹è±¡ä¼šè¢«å›æ”¶å—ï¼Ÿ</p>
<p>ä»€ä¹ˆæ—¶å€™æ‰§è¡ŒGCæˆ‘ä¹ˆæ˜¯ä¸æ¸…æ¥šçš„ï¼Œæ ¹æ®ä¸åŒçš„ç®—æ³•æœ‰ä¸åŒçš„è°ƒåº¦ï¼Œæœ‰çš„æ˜¯æ ¹æ®æ—¶é—´è°ƒåº¦ï¼Œæœ‰çš„æ˜¯æ ¹æ®<br>å†…å­˜ä½¿ç”¨çš„æƒ…å†µè¿›è¡Œè°ƒåº¦ã€‚</p>
<p>ä¸è¿‡è®©æˆ‘æ¥åšçš„è¯ï¼Œæˆ‘æ›´å€¾å‘äºåè€…ï¼Œä¸ç®¡è¿è¡Œå¤šé•¿æ—¶é—´åªè¦å†…å­˜æ²¡åˆ°æˆ‘æŒ‡å®šçš„é˜ˆå€¼å¤§å°æˆ‘å°±ä¸æ‰§è¡Œï¼Œ<br>ç°åœ¨çš„è¿™ä¸ªæƒ³æ³•æ¥æºhadoopçš„spillï¼Œå‡è®¾æœ‰100mçš„å†…å­˜ä½¿ç”¨ä½†æ˜¯åªè¦è¾¾åˆ°ä¸Šé™80mçš„å†…å­˜ç”¨é‡ï¼Œ<br>é‚£ä¹ˆæˆ‘å°±å¼€å§‹æ‰§è¡ŒGCã€‚ã€åªæ˜¯æˆ‘çš„æƒ³æ³•ï¼Œå“ˆå“ˆ~ã€‘</p>
<p>é‚£å¥½ï¼Œæ— è®ºæ˜¯æ ¹æ®æ—¶é—´åˆæˆ–è€…æ˜¯å†…å­˜å¤§å°è¿›è¡ŒGCï¼Œä½†æ˜¯æˆ‘ä¹ˆå°±ä¸€æ®µè¾“å‡ºä»£ç ï¼Œç¨‹åºç»“æŸäº†ä¼°è®¡ä¹Ÿä¸ä¼š<br>æ‰§è¡ŒGCçº¿ç¨‹è¿›è¡Œæ¸…ç†å§ï¼</p>
<p>æ²¡æœ‰æ‰§è¡ŒGCä¹Ÿå°±æ˜¯æ— æ³•æ‰§è¡Œåˆ°finalizeæ–¹æ³•äº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æ‰§è¡Œgcå‘¢ï¼Ÿæ–¹æ³•æ˜¯æœ‰çš„ï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½ä¿è¯ä¸€å®šä¼šæ‰§è¡Œgcï¼Œåªèƒ½è¯´ä¼šå‚¬ä¿ƒè¿›è€Œæ‰§è¡Œ<br>GCã€‚</p>
<p>è¿™ä¹Ÿå°±æ˜¯æˆ‘ä¹ˆå¸¸è¯´çš„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">System.gc()</div></pre></td></tr></table></figure></p>
<p>å½“ç„¶è¿˜å­˜åœ¨å…¶å®ƒæ–¹æ³•ï¼Œåœ¨æœ€åæˆ‘ä¼šå°†æˆ‘å‚è€ƒé“¾æ¥å‘å‡ºã€‚<br>é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„å¯¹è±¡ä¼šè¢«æ‰§è¡Œfinalizeæ–¹æ³•å‘¢ï¼Ÿfinalizeæ–¹æ³•åˆä¼šè¢«æ‰§è¡Œå¤šå°‘æ¬¡å‘¢ï¼Ÿ</p>
<h3 id="å¯¹è±¡é”€æ¯è¿‡ç¨‹"><a href="#å¯¹è±¡é”€æ¯è¿‡ç¨‹" class="headerlink" title="å¯¹è±¡é”€æ¯è¿‡ç¨‹"></a>å¯¹è±¡é”€æ¯è¿‡ç¨‹</h3><p>å¯¹è±¡çš„é”€æ¯è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ç…§å¯¹è±¡çš„finalizeæ‰§è¡Œæƒ…å†µï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼Œç³»ç»Ÿä¼šè®°å½•å¯¹è±¡çš„<br>å¯¹åº”çŠ¶æ€ã€‚</p>
<p>1ã€unfinalized æ²¡æœ‰æ‰§è¡Œfinalizeï¼Œç³»ç»Ÿä¹Ÿä¸å‡†å¤‡æ‰§è¡Œã€‚<br>2ã€finalizable å¯ä»¥æ‰§è¡Œfinalizeäº†ï¼Œç³»ç»Ÿä¼šåœ¨éšåçš„æŸä¸ªæ—¶é—´æ‰§è¡Œfinalizeã€‚<br>3ã€finalizedè¯¥å¯¹è±¡çš„finalizeå·²ç»è¢«æ‰§è¡Œäº†ã€‚ </p>
<p>GCæ€ä¹ˆæ¥ä¿æŒå¯¹finalizableçš„å¯¹è±¡çš„è¿½è¸ªå‘¢ã€‚GCæœ‰ä¸€ä¸ªQueueï¼Œ<br>å«åšF-Queueï¼Œæ‰€æœ‰å¯¹è±¡åœ¨å˜ä¸ºfinalizableçš„æ—¶å€™ä¼šåŠ å…¥åˆ°è¯¥Queueï¼Œç„¶åç­‰å¾…GCæ‰§è¡Œå®ƒçš„<br>finalizeæ–¹æ³•ã€‚</p>
<p>è¿™æ—¶æˆ‘ä»¬å¼•å…¥äº†å¯¹å¯¹è±¡çš„å¦å¤–ä¸€ç§è®°å½•åˆ†ç±»ï¼Œç³»ç»Ÿå¯ä»¥æ£€æŸ¥åˆ°ä¸€ä¸ªå¯¹è±¡å±äºå“ªä¸€ç§ã€‚</p>
<p>a.reachableï¼šæ´»åŠ¨çš„å¯¹è±¡å¼•ç”¨é“¾å¯ä»¥åˆ°è¾¾çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬æ‰€æœ‰çº¿ç¨‹å½“å‰æ ˆçš„å±€éƒ¨å˜é‡ï¼Œ<br>æ‰€æœ‰çš„é™æ€å˜é‡ç­‰ç­‰ã€‚ </p>
<p>b.finalizer-reachableé™¤äº†reachableå¤–ï¼Œä»F-Queueå¯ä»¥é€šè¿‡å¼•ç”¨åˆ°è¾¾çš„å¯¹è±¡ã€‚<br>c.unreachableå…¶å®ƒçš„å¯¹è±¡</p>
<p><img src="https://github.com/basebase/img_server/blob/master/java-finalize%E6%96%B9%E6%B3%95/gc.gif?raw=true" alt="è½¬æ¢è¿‡ç¨‹"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">1.é¦–å…ˆï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ä»Reachable+Unfinalizedèµ°å‘æ­»äº¡ä¹‹è·¯çš„ã€‚</div><div class="line"></div><div class="line">2.å½“å‰æ´»åŠ¨å¯¹è±¡ä¸å¯è¾¾æ—¶ï¼Œå¯¹è±¡å¯ä»¥ä»ReachableçŠ¶æ€å˜åˆ°F-Reachableæˆ–è€…UnreachableçŠ¶æ€ã€‚</div><div class="line"></div><div class="line">3.å½“å¯¹è±¡ä¸ºéReachable+Unfinalizedæ—¶ï¼ŒGCä¼šæŠŠå®ƒç§»å…¥F-Queueï¼Œ</div><div class="line">  çŠ¶æ€å˜ä¸ºF-Reachable+Finalizableã€‚</div><div class="line"></div><div class="line">4.å¥½äº†ï¼Œå…³é”®çš„æ¥äº†ï¼Œä»»ä½•æ—¶å€™ï¼ŒGCéƒ½å¯ä»¥ä»F-Queueä¸­æ‹¿åˆ°ä¸€ä¸ªFinalizableçš„å¯¹è±¡ï¼Œ</div><div class="line">  æ ‡è®°å®ƒä¸ºFinalizedï¼Œç„¶åæ‰§è¡Œå®ƒçš„finalizeæ–¹æ³•ï¼Œç”±äºè¯¥å¯¹è±¡åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­åˆå¯è¾¾äº†ï¼Œ</div><div class="line">  äºæ˜¯è¯¥å¯¹è±¡å˜æˆReachableäº†ï¼ˆå¹¶ä¸”Finalizedï¼‰ã€‚è€Œfinalizeæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œåˆæœ‰å¯èƒ½æŠŠå…¶å®ƒçš„F-Reachableçš„å¯¹è±¡å˜ä¸ºä¸€ä¸ªReachableçš„ï¼Œè¿™ä¸ªå«åšå¯¹è±¡å†ç”Ÿã€‚</div><div class="line"></div><div class="line">5.å½“ä¸€ä¸ªå¯¹è±¡åœ¨Unreachable+Unfinalizedæ—¶ï¼Œå¦‚æœè¯¥å¯¹è±¡ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„Objectçš„finalizeï¼Œ</div><div class="line">  æˆ–è€…è™½ç„¶é‡å†™äº†ï¼Œä½†æ˜¯æ–°çš„å®ç°ä»€ä¹ˆä¹Ÿä¸å¹²ã€‚ä¸ºäº†æ€§èƒ½ï¼ŒGCå¯ä»¥æŠŠè¯¥å¯¹è±¡ç›´æ¥å˜åˆ°ReclaimedçŠ¶æ€ç›´æ¥é”€æ¯ï¼Œè€Œä¸ç”¨åŠ å…¥åˆ°F-Queueç­‰å¾…GCåšè¿›ä¸€æ­¥å¤„ç†ã€‚</div><div class="line"></div><div class="line">6.ä»çŠ¶æ€å›¾çœ‹å‡ºï¼Œä¸ç®¡æ€ä¹ˆæŠ˜è…¾ï¼Œä»»æ„ä¸€ä¸ªå¯¹è±¡çš„finalizeåªè‡³å¤šæ‰§è¡Œä¸€æ¬¡ï¼Œä¸€æ—¦å¯¹è±¡å˜ä¸ºFinalized</div><div class="line">  å°±æ€ä¹ˆä¹Ÿä¸ä¼šåœ¨å›åˆ°F-Queueå»äº†ã€‚å½“ç„¶æ²¡æœ‰æœºä¼šå†æ‰§è¡Œfinalizeäº†ã€‚ </div><div class="line"></div><div class="line">7.å½“å¯¹è±¡å¤„äºUnreachable+Finalizedæ—¶ï¼Œè¯¥å¯¹è±¡ç¦»çœŸæ­£çš„æ­»äº¡ä¸è¿œäº†ã€‚GCå¯ä»¥å®‰å…¨çš„å›æ”¶è¯¥å¯¹è±¡çš„</div><div class="line">  å†…å­˜äº†ã€‚è¿›å…¥Reclaimedã€‚</div></pre></td></tr></table></figure>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</div><div class="line">	Test2 t2 ;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Test1</span><span class="params">(Test2 t2)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.t2 = t2;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Test1 finalize..."</span>);</div><div class="line">		Test3.t1 = <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;</div><div class="line">	String name;</div><div class="line">	<span class="keyword">int</span> age;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Test2</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">		<span class="keyword">this</span>.age = age;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Test2 finalize..."</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">"is "</span> + age;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test3</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">static</span> Test1 t1;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">		</div><div class="line">		Test1 t1 = <span class="keyword">new</span> Test1(<span class="keyword">new</span> Test2(<span class="string">"joker"</span>, <span class="number">18</span>));</div><div class="line">		System.out.println(t1);</div><div class="line">		t1 = <span class="keyword">null</span>;</div><div class="line">		</div><div class="line">		System.gc();</div><div class="line">		Thread.sleep(<span class="number">10000</span>);</div><div class="line">		System.out.println(Test3.t1);</div><div class="line">		System.out.println(Test3.t1.t2);</div><div class="line">		</div><div class="line">		t1 = <span class="keyword">null</span>;</div><div class="line">		System.gc();</div><div class="line">		System.out.println(<span class="string">"done."</span>);</div><div class="line">		</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">cn.base.gc.test.Test1@6b04d3c8</div><div class="line">[GC 2642K-&gt;437K(251392K), 0.0012310 secs]</div><div class="line">[Full GC 437K-&gt;350K(251392K), 0.0102620 secs]</div><div class="line">Test1 finalize...</div><div class="line">Test2 finalize...</div><div class="line">cn.base.gc.test.Test1@6b04d3c8</div><div class="line">jokeris 18</div><div class="line">[GC 2992K-&gt;446K(251392K), 0.0006800 secs]</div><div class="line">[Full GC 446K-&gt;350K(251392K), 0.0069980 secs]</div><div class="line">done.</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°çš„æ˜¯æˆ‘ä»¬åœ¨é‡Šæ”¾test1çš„æ—¶å€™æˆå‘˜å¯¹è±¡test2ä¹Ÿä¸€èµ·è¢«å›æ”¶äº†ï¼Œç”±äºtest1é‡å†™äº†finalize<br>æ–¹æ³•ï¼Œåœ¨æœ€åtest1åˆå¤æ´»äº†ã€‚</p>
<p>ç”±äºåœ¨GC Rootä¸­åˆæœ‰å¼•ç”¨é“¾èµ·æ­»å›ç”Ÿï¼Œä½†æ˜¯æˆ‘ä¹ˆå†ä¸€æ¬¡è®¾ç½®nullå¹¶æ‰§è¡Œgcå¯ä»¥çœ‹åˆ°test1å¯¹è±¡<br>æ²¡æœ‰åœ¨è¿›å…¥finalizeæ–¹æ³•äº†ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>finalizeæ–¹æ³•ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œçš„ï¼Œä½¿ç”¨System.gc()<br>ä¹Ÿåªä¸è¿‡æ˜¯åŠ å¿«gcè°ƒç”¨ï¼Œå¹¶ä¸”é‡å†™finalizeæ–¹æ³•æœ€å¥½ä¸è¦ä½¿å¯¹è±¡å†ç”Ÿï¼Œè¿™æ ·å®¹æ˜“é€ æˆ<br>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ··ä¹±ï¼</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://mazhuang.org/2015/12/15/java-object-finalize/" target="_blank" rel="external">http://mazhuang.org/2015/12/15/java-object-finalize/</a><br><a href="http://bijian1013.iteye.com/blog/2289661" target="_blank" rel="external">http://bijian1013.iteye.com/blog/2289661</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[mapreduceè®¡ç®—uv]]></title>
      <url>http://yoursite.com/2016/08/23/mapreduce%E8%AE%A1%E7%AE%97uv/</url>
      <content type="html"><![CDATA[<p>ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ä»¶?<br>æˆ‘ä»¬åœ¨ç»Ÿè®¡çš„æ—¶å€™pvå’Œuvå¯ä»¥è¯´çš„æœ€åŸºç¡€çš„ä¹Ÿæ˜¯æœ€å¸¸è§çš„ï¼Œç›¸ä¿¡åšæ•°æ®çš„éƒ½çŸ¥é“ã€‚è¿™ç§éœ€æ±‚<br>æˆ‘ä»¬ä¸€èˆ¬å°±æ˜¯ä½¿ç”¨hiveè¿›è¡Œç»Ÿè®¡å°±å®Œäº‹äº†ï¼Œéå¸¸çš„ç®€å•ã€‚<br>æ ¹æ®urlè®¡ç®—æ¯ä¸ªé¡µé¢çš„è®¿é—®æ¬¡æ•°å’Œç‹¬ç«‹è®¿å®¢ç”¨æˆ·æ•°ã€‚</p>
<a id="more"></a>
<h3 id="ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ä»¶"><a href="#ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ä»¶" class="headerlink" title="ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ä»¶?"></a>ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ä»¶?</h3><p>æˆ‘ä»¬åœ¨ç»Ÿè®¡çš„æ—¶å€™pvå’Œuvå¯ä»¥è¯´çš„æœ€åŸºç¡€çš„ä¹Ÿæ˜¯æœ€å¸¸è§çš„ï¼Œç›¸ä¿¡åšæ•°æ®çš„éƒ½çŸ¥é“ã€‚è¿™ç§éœ€æ±‚<br>æˆ‘ä»¬ä¸€èˆ¬å°±æ˜¯ä½¿ç”¨hiveè¿›è¡Œç»Ÿè®¡å°±å®Œäº‹äº†ï¼Œéå¸¸çš„ç®€å•ã€‚<br>æ ¹æ®urlè®¡ç®—æ¯ä¸ªé¡µé¢çš„è®¿é—®æ¬¡æ•°å’Œç‹¬ç«‹è®¿å®¢ç”¨æˆ·æ•°ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">count</span>(gi) <span class="keyword">as</span> <span class="string">'pv'</span>, <span class="keyword">count</span>(<span class="keyword">distinct</span> gi) <span class="keyword">as</span> <span class="string">'uv'</span> <span class="keyword">from</span> </div><div class="line"><span class="keyword">table</span> <span class="keyword">where</span> cdate = <span class="string">'2016-06-01'</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">url</span></div></pre></td></tr></table></figure>
<p>é‚£å¥½ï¼Œæˆ‘ä»¬é€šè¿‡mapreduceå¦‚ä½•è®¡ç®—å‘¢?<br>æˆ‘æƒ³æˆ‘å¤§å¤šæ•°äººéƒ½æ˜¯é€šè¿‡åœ¨reduceä¸­ä½¿ç”¨Setæˆ–è€…Listè¿›è¡Œåˆ¤æ–­æ˜¯å¦åœ¨é›†åˆä¸­å­˜åœ¨ï¼Œ<br>å¦‚æœä¸å­˜åœ¨é‚£ä¹ˆå°±åŠ 1ã€‚<br>äº‹å®å´æ˜¯å¦‚æ­¤ï¼Œæˆ‘æœç´¢å‘ç°å¾ˆå¤šblogéƒ½æ˜¯æ­¤æ–¹æ³•å¹¶ä¸”å†…å®¹å¤§è‡´ç›¸åŒï¼ŒåŒ…æ‹¬æˆ‘æœ€å¼€å§‹å†™çš„mapreduceä¹Ÿæ˜¯<br>æŒ‰ç…§è¿™ç§æ–¹æ³•åšçš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•åšæ•°æ®é‡å°çœ‹ä¸å‡ºé—®é¢˜ï¼Œä½†æ˜¯æ•°æ®é‡ä¸€æ—¦éå¸¸å¤§å°±é©¬ä¸Šå‡ºç°é—®é¢˜ã€‚<br>å› ä¸ºä½ çš„æ•°æ®æ”¾åœ¨äº†å†…å­˜ï¼Œå¾ˆå®¹æ˜“å°±oomäº†ã€‚</p>
<p>å…¶å®æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸¤ä¸ªmapreduceè¿›è¡Œè®¡ç®—ã€‚<br>ç¬¬ä¸€ä¸ªmapå°±æ˜¯åˆ†å‰²url+uidä½œä¸ºkeyï¼Œvalueä¸º1<br>æ•°æ®æ ¼å¼å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">http://www.google.com,zhangsan 1</div><div class="line">http://www.google.com,zhangsan 1</div><div class="line">http://www.google.com,zhangsan 1</div></pre></td></tr></table></figure>
<p>ç›¸åŒçš„keyå€¼å‘é€åˆ°åŒä¸€ä¸ªreduceä¸­ï¼Œè¿™æ ·çš„è¯zhangsançš„æ•°æ®éƒ½ä¸º1äº†ï¼Œreduceä¸ç”¨åšä»€ä¹ˆå°±æ˜¯<br>æŠŠkeyå†™å…¥å°±è¡Œã€‚</p>
<p>ç„¶ååˆ°äº†ç¬¬äºŒä¸ªmapä¸­ï¼Œæˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªreduceçš„æ•°æ®è¿›è¡Œæ‹†è§£å°±å¾—åˆ°äº†urlå’Œuidçš„æ•°æ®äº†<br>ç”±äºåœ¨ç¬¬ä¸€ä¸ªmrä¸­å·²ç»å°†ç›¸åŒçš„uidå’Œurlå½’ä¸ºä¸€ç±»ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨é‡å¤æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œå°±å’Œ<br>wordcountä¸€æ ·è®¡ç®—å°±è¡Œäº†ã€‚</p>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ä¸Šé¢å·²ç»è¯´äº†è¿™ä¹ˆå¤šäº†ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆä¹å‘³äº†ã€‚æ¥çœ‹çœ‹ä»£ç é†’é†’è„‘å§ï¼Œå˜¿å˜¿å˜¿~</p>
<p>ä½¿ç”¨hadoop2.7.0</p>
<p>æµ‹è¯•æ•°æ®:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">http://www.google.com,2016-01-02,dsadasd-dasd-as-das</div><div class="line">https://www.ibm.com/developerworks/cn/opensource/os-cn-hadoop-name-node/,2016-01-02,000-111-11-22</div><div class="line">http://www.jd.com/?keyword=dadas&amp;keywordid=34879410794&amp;re_dcp=202m0QjIIg==&amp;traffic_source=1004&amp;test=1&amp;enc=utf8&amp;cu=true&amp;utm_source=baidu-search&amp;utm_medium=cpc&amp;utm_campaign=t_262767352_baidusearch&amp;utm_term=34879410794_0_b0d37d1995654fdb9c013c4eb7544071,2016-01-02,dasdsa-ds-ad-as-da</div><div class="line">http://mall.jd.com/index-56654.html,2016-01-02,d99dsa-dsdasdsa-dasdj</div><div class="line">http://mall.jd.com/index-56654.html,2016-01-02,d99dsa-dsdasdsa-dasdj</div><div class="line">http://mall.jd.com/index-56654.html,2016-01-02,d99dsa-dsddddd-dsss</div><div class="line">http://mall.jd.com/index-56654.html,2016-01-02,d99dsa-dsdasdsa-dasdj</div><div class="line">http://item.jd.com/3148810.html,2016-01-02,d99dsa-dsdasdsa-dasdj</div><div class="line">http://item.jd.com/3148810.html,2016-01-02,d99dsa-dsdasdasda-sadas</div><div class="line">http://item.jd.com/3148762.html,2016-01-02,d99dsa-dsdasdsa-xxxx</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UVMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt; </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Text k = <span class="keyword">new</span> Text();</div><div class="line">	<span class="keyword">private</span> LongWritable v = <span class="keyword">new</span> LongWritable(<span class="number">1</span>);</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Context context)</span></span></div><div class="line">			<span class="keyword">throws</span> IOException, InterruptedException &#123;</div><div class="line">		</div><div class="line">		String line = value.toString();</div><div class="line">		String[] tokens = line.split(<span class="string">","</span>);</div><div class="line">		</div><div class="line">		<span class="comment">// url + uid</span></div><div class="line">		k.set(tokens[<span class="number">0</span>] + <span class="string">","</span> + tokens[<span class="number">2</span>]);</div><div class="line">		context.write(k, v);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UVReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;LongWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">		context.write(key, NullWritable.get());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UVMapperUp</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt; </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Text k = <span class="keyword">new</span> Text();</div><div class="line">	<span class="keyword">private</span> LongWritable v = <span class="keyword">new</span> LongWritable(<span class="number">1</span>);</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Context context)</span></span></div><div class="line">			<span class="keyword">throws</span> IOException, InterruptedException &#123;</div><div class="line">		</div><div class="line">		String line = value.toString();</div><div class="line">		String[] tokens = line.split(<span class="string">","</span>);</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (tokens.length != <span class="number">2</span>) &#123;</div><div class="line">			<span class="keyword">return</span> ;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		String url = tokens[<span class="number">0</span>];</div><div class="line">		</div><div class="line">		k.set(url);</div><div class="line">		context.write(k, v);</div><div class="line">		</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UVReducerUp</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt; </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> LongWritable res = <span class="keyword">new</span> LongWritable();</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;LongWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line">		<span class="keyword">long</span> sum = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (LongWritable val : values) &#123;</div><div class="line">			sum += val.get();</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		res.set(sum);</div><div class="line">		</div><div class="line">		context.write(key, res);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configured;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.TextInputFormat;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.util.Tool;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.util.ToolRunner;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UVApp</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			</div><div class="line">			args = <span class="keyword">new</span> String[]&#123;<span class="string">"in/browse.txt"</span>, <span class="string">"uv_out"</span>, <span class="string">"f_uv_out"</span>&#125;;</div><div class="line">			ToolRunner.run(<span class="keyword">new</span> Configuration(), <span class="keyword">new</span> UVApp(), args);</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		</div><div class="line">		</div><div class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</div><div class="line">		Job job1 = Job.getInstance(conf, <span class="string">"uv"</span>);</div><div class="line">		Job job2 = Job.getInstance(conf, <span class="string">"uv"</span>);</div><div class="line">		</div><div class="line">		job1.setJarByClass(UVApp.class);</div><div class="line">		job2.setJarByClass(UVApp.class);</div><div class="line">		</div><div class="line">		job1.setMapperClass(UVMapper.class);</div><div class="line">		job1.setReducerClass(UVReducer.class);</div><div class="line">		</div><div class="line">		job2.setMapperClass(UVMapperUp.class);</div><div class="line">		job2.setReducerClass(UVReducerUp.class);</div><div class="line">		</div><div class="line">		job1.setMapOutputKeyClass(Text.class);</div><div class="line">		job1.setMapOutputValueClass(LongWritable.class);</div><div class="line">		</div><div class="line">		job2.setMapOutputKeyClass(Text.class);</div><div class="line">		job2.setOutputValueClass(LongWritable.class);</div><div class="line">		</div><div class="line">		job1.setOutputKeyClass(Text.class);</div><div class="line">		job1.setOutputValueClass(NullWritable.class);</div><div class="line">		</div><div class="line">		job2.setOutputKeyClass(Text.class);</div><div class="line">		job2.setOutputValueClass(LongWritable.class);</div><div class="line">		</div><div class="line">		FileInputFormat.addInputPath(job1, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</div><div class="line">		FileOutputFormat.setOutputPath(job1, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</div><div class="line">		</div><div class="line">		FileInputFormat.addInputPath(job2, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</div><div class="line">		FileOutputFormat.setOutputPath(job2, <span class="keyword">new</span> Path(args[<span class="number">2</span>]));</div><div class="line">		</div><div class="line">		<span class="keyword">int</span> code = job1.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>;</div><div class="line">		</div><div class="line">		<span class="keyword">if</span>(code != <span class="number">0</span>)&#123;</div><div class="line">			System.exit(<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> job2.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p> ä¸€èˆ¬ä½¿ç”¨åˆ†å¸ƒå¼æ¡†æ¶è¡¨ç¤ºæˆ‘ä»¬æ•°æ®æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ”¾å†…å­˜è‚¯å®šæ˜¯ä¸åˆç†çš„ã€‚<br> çœ‹æ¥ä»£ç è´¨é‡æœ‰å¾…æé«˜ï¼ï¼ï¼</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[stormæ•´åˆkafkaé‡å¤æ¶ˆè´¹é—®é¢˜åˆ†æ]]></title>
      <url>http://yoursite.com/2016/08/11/storm%E6%95%B4%E5%90%88kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/</url>
      <content type="html"><![CDATA[<p>ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ?<br>æœ€è¿‘åœ¨æ•´åˆstorm+kafkaä¸€ç›´çº ç»“äºé‡å¤æ•°æ®çš„è¯»å–ï¼Œé‡æ–°å¯åŠ¨topologyæ›´æ˜¯æŠŠkafkaçš„æ•°æ®æ‰«æä¸€éï¼Œ<br>ã€å¦‚æœçº¿ä¸Šé€»è¾‘è¾ƒé‡ï¼Œå¹¶ä¸”è¿˜è¦å¾€æ•°æ®åº“é‡Œé¢æ’å…¥æ•°æ®æ˜¯ä¸æ˜¯æœ‰å¾ˆå¤šé‡å¤æ•°æ®äº†ï¼ã€‘</p>
<a id="more"></a>
<h3 id="ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« "><a href="#ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« " class="headerlink" title="ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ?"></a>ä¸ºä»€ä¹ˆå†™è¿™ç¯‡æ–‡ç« ?</h3><p>æœ€è¿‘åœ¨æ•´åˆstorm+kafkaä¸€ç›´çº ç»“äºé‡å¤æ•°æ®çš„è¯»å–ï¼Œé‡æ–°å¯åŠ¨topologyæ›´æ˜¯æŠŠkafkaçš„æ•°æ®æ‰«æä¸€éï¼Œ<br>ã€å¦‚æœçº¿ä¸Šé€»è¾‘è¾ƒé‡ï¼Œå¹¶ä¸”è¿˜è¦å¾€æ•°æ®åº“é‡Œé¢æ’å…¥æ•°æ®æ˜¯ä¸æ˜¯æœ‰å¾ˆå¤šé‡å¤æ•°æ®äº†ï¼ã€‘</p>
<h3 id="è½¯ä»¶ç¯å¢ƒ"><a href="#è½¯ä»¶ç¯å¢ƒ" class="headerlink" title="è½¯ä»¶ç¯å¢ƒ"></a>è½¯ä»¶ç¯å¢ƒ</h3><p>zookeeper-3.4.6.tar.gz<br>kafka_2.9.2-0.8.1.1<br>apache-storm-1.0.1.tar.gz</p>
<h3 id="å®è·µå‡ºçœŸçŸ¥"><a href="#å®è·µå‡ºçœŸçŸ¥" class="headerlink" title="å®è·µå‡ºçœŸçŸ¥"></a>å®è·µå‡ºçœŸçŸ¥</h3><p>é‚£æˆ‘ä»¬çŸ¥é“è¿™kafkaå’Œstorméƒ½æ˜¯ä¾èµ–zkçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨åˆ›å»ºtopologyçš„æ—¶å€™ä¹Ÿæ˜¯æŠŠoffsetå†™å…¥åˆ°zk<br>ä½†æ˜¯ä¸€å¼€å§‹çš„ç¨‹åºæ˜¯éå¸¸å¥‡æ€ªçš„ï¼Œzkå¹¶æ²¡æœ‰åˆ›å»ºæˆ‘æ‰€æŒ‡å®šçš„ç›®å½•å’Œidã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªâ€é”™è¯¯â€çš„ä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> cn.base.sk.ex03;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.storm.task.OutputCollector;</div><div class="line"><span class="keyword">import</span> org.apache.storm.task.TopologyContext;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.OutputFieldsDeclarer;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.base.BaseRichBolt;</div><div class="line"><span class="keyword">import</span> org.apache.storm.tuple.Tuple;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SplitBolt</span> <span class="keyword">extends</span> <span class="title">BaseRichBolt</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">1380001209433177193L</span>;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> OutputCollector collector = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(Map stormConf, TopologyContext context, OutputCollector collector)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.collector = collector;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Tuple input)</span> </span>&#123;</div><div class="line">		String word = input.getString(<span class="number">0</span>);</div><div class="line">		System.out.println(<span class="string">"source data =&gt; "</span> + word);</div><div class="line">		<span class="comment">//collector.ack(input);</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">declareOutputFields</span><span class="params">(OutputFieldsDeclarer declarer)</span> </span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.base.sk.ex03;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Arrays;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.storm.Config;</div><div class="line"><span class="keyword">import</span> org.apache.storm.LocalCluster;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.BrokerHosts;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.KafkaSpout;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.SpoutConfig;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.StringScheme;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.ZkHosts;</div><div class="line"><span class="keyword">import</span> org.apache.storm.spout.SchemeAsMultiScheme;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.TopologyBuilder;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.base.sk.ex02.MyKafkaTopology;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaTopology</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		String zks = <span class="string">"localhost:2181/kafka"</span>;</div><div class="line">		String topic = <span class="string">"topic2"</span>;</div><div class="line">		String zkRoot = <span class="string">"/topic2"</span>;</div><div class="line">		String id = <span class="string">"split"</span>;</div><div class="line"></div><div class="line">		BrokerHosts brokerHosts = <span class="keyword">new</span> ZkHosts(zks);</div><div class="line">		SpoutConfig spoutConf = <span class="keyword">new</span> SpoutConfig(brokerHosts, topic, zkRoot, id);</div><div class="line">		spoutConf.scheme = <span class="keyword">new</span> SchemeAsMultiScheme(<span class="keyword">new</span> StringScheme());</div><div class="line">		spoutConf.zkServers = Arrays.asList(<span class="keyword">new</span> String[] &#123;<span class="string">"localhost"</span>&#125;);</div><div class="line">		spoutConf.zkPort = <span class="number">2181</span>;</div><div class="line"></div><div class="line"></div><div class="line">		TopologyBuilder builder = <span class="keyword">new</span> TopologyBuilder();</div><div class="line">		builder.setSpout(<span class="string">"kafka-spoutx"</span>, <span class="keyword">new</span> KafkaSpout(spoutConf));</div><div class="line">		builder.setBolt(<span class="string">"word-splitx"</span>, <span class="keyword">new</span> SplitBolt()).shuffleGrouping(<span class="string">"kafka-spoutx"</span>);</div><div class="line"></div><div class="line">		Config conf = <span class="keyword">new</span> Config();</div><div class="line">		String name = MyKafkaTopology.class.getSimpleName();</div><div class="line">		conf.setMaxTaskParallelism(<span class="number">3</span>);</div><div class="line"></div><div class="line">		LocalCluster cluster = <span class="keyword">new</span> LocalCluster();</div><div class="line">		cluster.submitTopology(name, conf, builder.createTopology());</div><div class="line"></div><div class="line"><span class="comment">//		Utils.sleep(10000);</span></div><div class="line"><span class="comment">//		cluster.shutdown();</span></div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">`</div></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¯æ— æ³•åœ¨zkä¸­åˆ›å»º/topic2/splitçš„ï¼Œè‡³äºä¸ºä»€ä¹ˆæˆ‘åœ¨åé¢ä¼šè¯´æ˜ã€‚<br>ç”±äºä¹Ÿæ˜¯æœ€è¿‘å‡ å¤©æ‰å¼€å§‹æ’¸èµ·æ¥çš„æ‰€ä»¥æˆ‘å°±å„ç§æœç´¢ï¼Œåœ¨ä¸€ä¸ªblogä¸­æ‰¾åˆ°äº†è¯´æ˜</p>
<p><font color="DeepPink" size="2">åŸæ–‡<br>    æ­¤å¤„éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œè¦ä½¿ç”¨backtype.storm.topology.base.BaseBasicBoltå¯¹è±¡ä½œä¸ºçˆ¶ç±»ï¼Œå¦åˆ™ä¸ä¼šåœ¨zkè®°å½•åç§»é‡offsetæ•°æ®ã€‚<br></font><br>åæ¥æˆ‘ä¿®æ”¹boltç»§æ‰¿è¯¥ç±»ç¡®å®åœ¨zkä¸­åˆ›å»ºå‡ºäº†topicï¼Œä½†æ˜¯è‡³äºä¸ºä»€ä¹ˆå¹¶æ²¡æœ‰è¯¦ç»†è¯´æ˜ã€‚<br>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¿®æ”¹åçš„codeã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> cn.base.sk.ex02;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</div><div class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</div><div class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</div><div class="line"><span class="keyword">import</span> org.apache.storm.task.OutputCollector;</div><div class="line"><span class="keyword">import</span> org.apache.storm.task.TopologyContext;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.BasicOutputCollector;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.OutputFieldsDeclarer;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.base.BaseBasicBolt;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.base.BaseRichBolt;</div><div class="line"><span class="keyword">import</span> org.apache.storm.tuple.Fields;</div><div class="line"><span class="keyword">import</span> org.apache.storm.tuple.Tuple;</div><div class="line"><span class="keyword">import</span> org.apache.storm.tuple.Values;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaWordSplitter</span> <span class="keyword">extends</span> <span class="title">BaseBasicBolt</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Log logger = LogFactory.getLog(KafkaWordSplitter.class);</div><div class="line">	<span class="keyword">private</span> OutputCollector collector;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Tuple input, BasicOutputCollector collector)</span> </span>&#123;</div><div class="line">		String line = input.getString(<span class="number">0</span>);</div><div class="line">		System.out.println(<span class="string">"RECV[kafka -&gt; splitter] "</span> + line);</div><div class="line"></div><div class="line">		String[] words = line.split(<span class="string">","</span>);</div><div class="line">		<span class="keyword">for</span> (String word : words) &#123;</div><div class="line">			System.out.println(<span class="string">"EMIT[splitter -&gt; counter] "</span> + word);</div><div class="line">			collector.emit(<span class="keyword">new</span> Values(word, <span class="number">1</span>));</div><div class="line">		&#125;</div><div class="line"></div><div class="line"><span class="comment">//		collector.ack(input);</span></div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">declareOutputFields</span><span class="params">(OutputFieldsDeclarer declarer)</span> </span>&#123;</div><div class="line">		declarer.declare(<span class="keyword">new</span> Fields(<span class="string">"word"</span>, <span class="string">"count"</span>));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">`</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.base.sk.ex02;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> java.util.Map.Entry;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</div><div class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</div><div class="line"><span class="keyword">import</span> org.apache.storm.task.OutputCollector;</div><div class="line"><span class="keyword">import</span> org.apache.storm.task.TopologyContext;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.BasicOutputCollector;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.OutputFieldsDeclarer;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.base.BaseBasicBolt;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.base.BaseRichBolt;</div><div class="line"><span class="keyword">import</span> org.apache.storm.tuple.Tuple;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCounter</span> <span class="keyword">extends</span> <span class="title">BaseBasicBolt</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Log logger = LogFactory.getLog(WordCounter.class);</div><div class="line">	<span class="keyword">private</span> OutputCollector collector;</div><div class="line">	<span class="keyword">private</span> Map&lt;String, AtomicInteger&gt; countMap;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(Map stormConf, TopologyContext context)</span> </span>&#123;</div><div class="line">		countMap = <span class="keyword">new</span> HashMap&lt;String, AtomicInteger&gt;();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"The final result:"</span>);</div><div class="line">		Iterator&lt;Entry&lt;String, AtomicInteger&gt;&gt; iter = <span class="keyword">this</span>.countMap.entrySet().iterator();</div><div class="line">		<span class="keyword">while</span> (iter.hasNext()) &#123;</div><div class="line"></div><div class="line">			Entry&lt;String, AtomicInteger&gt; entry = iter.next();</div><div class="line">			System.out.println(entry.getKey() + <span class="string">"\t:\t"</span> + entry.getValue().get());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Tuple input, BasicOutputCollector collector)</span> </span>&#123;</div><div class="line">		String word = input.getString(<span class="number">0</span>);</div><div class="line">		Integer count = input.getInteger(<span class="number">1</span>);</div><div class="line"></div><div class="line">		System.out.println(<span class="string">"RECV[splitter -&gt; counter] "</span> + word + <span class="string">" : "</span> + count);</div><div class="line">		AtomicInteger ai = <span class="keyword">this</span>.countMap.get(word);</div><div class="line">		<span class="keyword">if</span> (ai == <span class="keyword">null</span>) &#123;</div><div class="line">			ai = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</div><div class="line">			<span class="keyword">this</span>.countMap.put(word, ai);</div><div class="line">		&#125;<span class="keyword">else</span> &#123;</div><div class="line">			ai.addAndGet(count);</div><div class="line"><span class="comment">//			collector.ack(input);</span></div><div class="line">			System.out.println(<span class="string">"CHECK statistics map: "</span> + <span class="keyword">this</span>.countMap);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">declareOutputFields</span><span class="params">(OutputFieldsDeclarer declarer)</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.base.sk.ex02;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.kafka.common.utils.Utils;</div><div class="line"><span class="keyword">import</span> org.apache.storm.Config;</div><div class="line"><span class="keyword">import</span> org.apache.storm.LocalCluster;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.BrokerHosts;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.KafkaSpout;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.SpoutConfig;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.StringScheme;</div><div class="line"><span class="keyword">import</span> org.apache.storm.kafka.ZkHosts;</div><div class="line"><span class="keyword">import</span> org.apache.storm.spout.SchemeAsMultiScheme;</div><div class="line"><span class="keyword">import</span> org.apache.storm.topology.TopologyBuilder;</div><div class="line"><span class="keyword">import</span> org.apache.storm.tuple.Fields;</div><div class="line"></div><div class="line"><span class="keyword">import</span> scala.actors.threadpool.Arrays;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyKafkaTopology</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		String zks = <span class="string">"localhost:2181/kafka"</span>;</div><div class="line">		String topic = <span class="string">"topic1"</span>;</div><div class="line">		String zkRoot = <span class="string">"/topic1"</span>;</div><div class="line">		String id = <span class="string">"word"</span>;</div><div class="line"></div><div class="line">		BrokerHosts brokerHosts = <span class="keyword">new</span> ZkHosts(zks);</div><div class="line">		SpoutConfig spoutConf = <span class="keyword">new</span> SpoutConfig(brokerHosts, topic, zkRoot, id);</div><div class="line">		spoutConf.scheme = <span class="keyword">new</span> SchemeAsMultiScheme(<span class="keyword">new</span> StringScheme());</div><div class="line">		spoutConf.zkServers = Arrays.asList(<span class="keyword">new</span> String[] &#123;<span class="string">"localhost"</span>&#125;);</div><div class="line">		spoutConf.zkPort = <span class="number">2181</span>;</div><div class="line"></div><div class="line"></div><div class="line">		TopologyBuilder builder = <span class="keyword">new</span> TopologyBuilder();</div><div class="line">		builder.setSpout(<span class="string">"kafka-spout"</span>, <span class="keyword">new</span> KafkaSpout(spoutConf));</div><div class="line">		builder.setBolt(<span class="string">"word-split"</span>, <span class="keyword">new</span> KafkaWordSplitter()).shuffleGrouping(<span class="string">"kafka-spout"</span>);</div><div class="line">		builder.setBolt(<span class="string">"word-count"</span>, <span class="keyword">new</span> WordCounter()).fieldsGrouping(<span class="string">"word-split"</span>, <span class="keyword">new</span> Fields(<span class="string">"word"</span>));</div><div class="line"></div><div class="line">		Config conf = <span class="keyword">new</span> Config();</div><div class="line">		String name = MyKafkaTopology.class.getSimpleName();</div><div class="line">		conf.setMaxTaskParallelism(<span class="number">3</span>);</div><div class="line"></div><div class="line">		LocalCluster cluster = <span class="keyword">new</span> LocalCluster();</div><div class="line">		cluster.submitTopology(name, conf, builder.createTopology());</div><div class="line"></div><div class="line"><span class="comment">//		Utils.sleep(10000);</span></div><div class="line"><span class="comment">//		cluster.shutdown();</span></div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åŸè°…æˆ‘å†™äº†ä¸¤ä¸ªä¾‹å­å§!<br>å¥½çš„ï¼Œä¸Šé¢ä¸€å¤§æ®µä»£ç æ˜¯ä¿®æ”¹è¿‡çš„ã€‚æ­¤æ—¶è¿›å…¥zkcliå·²ç»åˆ›å»ºå‡ºæ¥äº†æˆ‘ä»¬æ‰€éœ€çš„è·¯å¾„<br>å¹¶ä¸”å·²ç»è®°å½•äº†offset</p>
<p><img src="https://github.com/basebase/img_server/blob/master/storm%E6%95%B4%E5%90%88kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90_img/01.png?raw=true" alt="zkæ•°æ®"></p>
<p>è¯»å–æ•°æ®çš„æ—¶å€™å°±ä»è¿™é‡Œå¼€å§‹äº†ã€‚<br>é‚£å¥½ï¼Œä¸ºå•¥ç»§æ‰¿äº†BaseBasicBoltç±»å°±å¯ä»¥ï¼Œè€ŒBaseRichBoltç±»å°±ä¸è¡Œå‘¢ã€‚</p>
<h3 id="èµ°è¿›æºç "><a href="#èµ°è¿›æºç " class="headerlink" title="èµ°è¿›æºç "></a>èµ°è¿›æºç </h3><p>é¦–å…ˆçœ‹çœ‹KafkaSpoutç±»çš„openæ–¹æ³•åšäº†ä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œ<br>ä¸‹å›¾æ‰æ˜¯æˆ‘ä¹ˆè¦çœ‹çš„</p>
<p><img src="https://github.com/basebase/img_server/blob/master/storm%E6%95%B4%E5%90%88kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90_img/02.png?raw=true" alt="kafkaSpout!nextTuple"></p>
<p>ä¸ç”¨åœ¨æ„å…¶å®ƒæ–¹æ³•ï¼Œç›´æ¥è¿›å…¥commit()æ–¹æ³•<br><img src="https://github.com/basebase/img_server/blob/master/storm%E6%95%B4%E5%90%88kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90_img/03.png?raw=true" alt="kafkaSpout!commit"></p>
<p>çœ‹åˆ°æ²¡ï¼Œ åªè¦ifæˆç«‹å°±ä¼šåœ¨zkä¸­åˆ›å»ºæ•°æ®ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆä¸èƒ½è¿›å…¥å‘¢ï¼Œæ¥çœ‹çœ‹lastCompletedOffset<br><img src="https://github.com/basebase/img_server/blob/master/storm%E6%95%B4%E5%90%88kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90_img/04.png?raw=true" alt="kafkaSpout!lastCompletedOffset"></p>
<p>å½“ä½ debugåˆ°è¿™é‡Œçš„æ—¶å€™é¦–å…ˆè·å–çš„æ˜¯ç¬¬ä¸€ä¸ªkeyï¼Œè¿™ä¸ªmapçš„keyæ˜¯offsetï¼Œvalueæ˜¯timestamp<br>è¯»ä¸€æ¬¡ä¼šå’Œä¸Šä¸€æ¬¡è¿›è¡Œæ¯”è¾ƒï¼Œæœ€ç»ˆåœ¨é‡Œé¢é‡æ–°èµ‹å€¼æœ€æ–°çš„offsetã€‚</p>
<p>ä»”ç»†è§‚å¯Ÿï¼Œå¦‚æœç»§æ‰¿BaseRichSpoutç±»ï¼Œè°ƒç”¨è¿‡åmapçš„keyä¾æ—§å­˜åœ¨ï¼Œè€ŒBaseBasicBoltä¼šè¿›è¡Œåˆ é™¤ï¼Œå¦‚æœä¸åˆ é™¤çš„è¯ä¼šåœ¨commitåˆ¤æ–­æ—¶å€™ä¸€ç›´ç›¸ç­‰ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è¿›è¡Œåˆ é™¤çš„å‘¢ï¼Ÿå¦‚æœæ˜¯ä½ ï¼Œä½ ä¼šæƒ³åœ¨ä»€ä¹ˆæ—¶å€™æŠŠè¿™ä»½æ•°æ®è¿›è¡Œåˆ é™¤ï¼Ÿ<br>å¯¹çš„ï¼Œå½“æˆ‘ä»¬ç¡®è®¤å®Œæ¯•è¿™æ¡æ•°æ®è¢«æ¶ˆè´¹åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œåˆ é™¤äº†ã€‚</p>
<p>åœ¨è¿›è¡Œackä¹‹åï¼Œæˆ‘ä»¬çœ‹åˆ°åˆ é™¤mapçš„æ•°æ®ï¼Œè¿™æ ·å°±é¡ºåˆ©çš„åœ¨zké‡Œé¢åˆ›å»ºå¹¶å†™å…¥æ•°æ®ã€‚<br><img src="https://github.com/basebase/img_server/blob/master/storm%E6%95%B4%E5%90%88kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90_img/05.png?raw=true" alt="kafkaSpout!ack"></p>
<p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘å°±æƒ³ç»§æ‰¿è‡ªBaseRichBoltç±»ï¼Œé‚£æœ‰åŠæ³•å®ç°å—ï¼Ÿè‚¯å®šçš„ï¼Œä½ åªéœ€è¦è‡ªå·±ackä¸€ä¸‹å°±è¡Œäº†<br><img src="https://github.com/basebase/img_server/blob/master/storm%E6%95%B4%E5%90%88kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90_img/06.png?raw=true" alt="UserBolt!ack"></p>
<p>okï¼Œæ­¤æ—¶ä½ åœ¨æ¬¡æ‰“å¼€zkcliæŸ¥çœ‹å°±å­˜åœ¨æŒ‡å®šçš„ç›®å½•å’Œidï¼Œå¹¶ä¸”é‡å¯topologyä¹Ÿä¸ä¼šé‡æ–°è¯»å–å†å²ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>BaseBasicBoltæ²¡æœ‰æä¾›ackè€Œæ˜¯éšç¤ºè¿›è¡Œäº†è°ƒç”¨ï¼Œè€ŒBaseRichSpoutéœ€è¦æ˜¾ç¤ºè°ƒç”¨ã€‚</p>
<h3 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h3><p>å‚è€ƒï¼š<a href="http://www.howardliu.cn/a-few-notes-about-storm/" target="_blank" rel="external">http://www.howardliu.cn/a-few-notes-about-storm/</a></p>
]]></content>
    </entry>
    
  
  
</search>
